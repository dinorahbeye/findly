<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Изменить локацию</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #1f2937; }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div class="flex flex-col min-h-screen">
        <header class="bg-gray-800 p-3 shadow-md">
            <h1 class="text-lg font-semibold text-center">Изменить локацию</h1>
        </header>
        <main class="flex-grow mx-4 mt-3 p-4 bg-gray-800 rounded-lg shadow-md">
            <div class="space-y-3">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-300">Имя пользователя</label>
                    <input type="text" id="username" class="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" placeholder="@vanekking22">
                </div>
                <div>
                    <label for="lat" class="block text-sm font-medium text-gray-300">Широта</label>
                    <input type="text" id="lat" class="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" placeholder="55.7558">
                </div>
                <div>
                    <label for="lon" class="block text-sm font-medium text-gray-300">Долгота</label>
                    <input type="text" id="lon" class="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" placeholder="37.6173">
                </div>
                <div>
                    <label for="place_name" class="block text-sm font-medium text-gray-300">Название места</label>
                    <input type="text" id="place_name" class="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" placeholder="Москва, Красная площадь">
                </div>
                <div>
                    <label for="avatar_url" class="block text-sm font-medium text-gray-300">URL аватара</label>
                    <input type="text" id="avatar_url" class="mt-1 block w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" placeholder="photos/avatar_vanekking22.jpg">
                </div>
                <button onclick="updateLocation()" class="w-full py-2 bg-blue-700 text-white rounded-md hover:bg-blue-800 transition-colors text-sm">Обновить локацию</button>
                <a href="map.html" class="block text-center text-blue-400 hover:text-blue-300 text-sm">Вернуться к карте</a>
            </div>
        </main>
        <footer class="bg-gray-900 text-gray-400 text-center p-3 text-sm">
            <p>Создано с ❤️ для @vanekking22</p>
        </footer>
    </div>
    <script>
        // Загружаем данные из localStorage или используем значения по умолчанию
        let locations = JSON.parse(localStorage.getItem('locations')) || {
            '@vanekking22': {
                lat: 55.7558,
                lon: 37.6173,
                place_name: 'Москва, Красная площадь',
                avatar_url: 'photos/avatar_vanekking22.jpg'
            }
        };

        // Получаем username из URL
        const urlParams = new URLSearchParams(window.location.search);
        const username = urlParams.get('username') || '@vanekking22';

        // Заполняем форму текущими данными
        const userData = locations[username] || {
            lat: 55.7558,
            lon: 37.6173,
            place_name: 'Москва, Красная площадь',
            avatar_url: 'photos/avatar_vanekking22.jpg'
        };
        document.getElementById('username').value = username;
        document.getElementById('lat').value = userData.lat;
        document.getElementById('lon').value = userData.lon;
        document.getElementById('place_name').value = userData.place_name;
        document.getElementById('avatar_url').value = userData.avatar_url;

        // Функция обновления локации
        function updateLocation() {
            const newUsername = document.getElementById('username').value.trim() || '@vanekking22';
            if (!newUsername.startsWith('@')) {
                alert('Имя пользователя должно начинаться с @');
                return;
            }
            const lat = parseFloat(document.getElementById('lat').value);
            const lon = parseFloat(document.getElementById('lon').value);
            const place_name = document.getElementById('place_name').value.trim();
            const avatar_url = document.getElementById('avatar_url').value.trim();

            if (isNaN(lat) || isNaN(lon)) {
                alert('Пожалуйста, введите корректные координаты (широта и долгота должны быть числами).');
                return;
            }

            locations[newUsername] = {
                lat: lat,
                lon: lon,
                place_name: place_name || 'Неизвестное место',
                avatar_url: avatar_url || 'photos/avatar_vanekking22.jpg'
            };

            // Сохраняем в localStorage
            localStorage.setItem('locations', JSON.stringify(locations));

            // Перенаправляем на карту с новым пользователем
            window.location.href = `map.html?username=${encodeURIComponent(newUsername)}`;
        }
    </script>
</body>
</html>